# Makefile for for testing aplette

# point to the just built copy (not the installed version)
APLEXE = ../source/aplette

DIFF = @diff@

OBJECTS = printing.dif quad_vars.dif \
          format.dif trig.dif errors.dif \
          scalar_monadic.dif scalar_dyadic.dif \
          mixed_monadic.dif mixed_dyadic.dif \
          struct_monadic.adif struct_dyadic.adif \
          mixed_monadic.adif mixed_dyadic.adif \
          userfunc_nilret1.adif userfunc_twoargs1.adif \
          userfunc_onearg1.adif userfunc_withret1.adif \
		  userfunc_shadow_arg.adif \
		  quad_fx.adif encode.adif

# Keep *.out files
.PRECIOUS: %.out %.aout

# As long as the following is the first target,
# everything will get tested
all: $(OBJECTS)

%.dif: %.out
	$(DIFF) $< $*.ref > $@

%.out: %.inp $(APLEXE)
	$(APLEXE) < $<  | sed -e 's/[0-9][0-9]:[0-9][0-9]\.[0-9][0-9] [0-9][0-9]\/[0-9][0-9]\/[0-9][0-9]/hh:mm.ss mm\/dd\/yy/' > $@
	echo >> $@

%.adif: %.aout
	$(DIFF) $< $*.aref > $@

%.aout: %.ainp $(APLEXE)
	$(APLEXE) < $<  | sed -e 's/[0-9][0-9]:[0-9][0-9]\.[0-9][0-9] [0-9][0-9]\/[0-9][0-9]\/[0-9][0-9]/hh:mm.ss mm\/dd\/yy/' > $@
	echo >> $@

clean:
	rm -f *.dif  *.out aplws.abort clean_dir/aplws.abort \
          *.adif *.aout clean_dir/core.* core.*
